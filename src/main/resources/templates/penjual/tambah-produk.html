<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UBeli - Jual Barang</title>

    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/jual.css">
</head>

<body>

<div th:replace="fragments/navbar-penjual :: navbar-penjual"></div>

<main class="container jual-wrapper">

    <h1 class="jual-title">Jual Barang</h1>

    <div class="form-box">

        <form th:action="@{/penjual/tambah-produk}" method="post" enctype="multipart/form-data" class="form-jual">

            <h3 class="form-section-title">Informasi Dasar</h3>

            <!-- KATEGORI -->
            <div class="form-group">
                <label>Kategori</label>
                <select name="kategoriId" required class="input-field">
                    <option value="">Pilih Kategori</option>
                    <option value="10001">Furnitur</option>
                    <option value="10002">Buku</option>
                    <option value="10003">Elektronik</option>
                    <option value="10004">Pakaian</option>
                </select>
            </div>

            <!-- MERK -->
            <div class="form-group">
                <label>Merk</label>
                <input type="text" name="merk" placeholder="Merk" required class="input-field">
            </div>

            <!-- NAMA PRODUK -->
            <div class="form-group">
                <label>Nama Produk</label>
                <input type="text" name="namaProduk" placeholder="Nama Produk" required class="input-field">
            </div>

            <!-- KONDISI -->
            <div class="form-group">
                <label>Kondisi</label>
                <select name="kondisi" required class="input-field">
                    <option value="">Pilih Kondisi</option>
                    <option value="Baru">Baru</option>
                    <option value="Bekas">Bekas</option>
                </select>
            </div>

            <!-- HARGA -->
            <div class="form-group">
                <label>Harga</label>
                <input type="text" id="hargaInput" name="hargaDisplay" placeholder="Rp 0" class="input-field">
                <input type="hidden" id="hargaReal" name="harga" value="" required>

            </div>

            <!-- DESKRIPSI -->
            <div class="form-group">
                <label>Deskripsi</label>
                <textarea name="deskripsi" placeholder="Tambahkan deskripsi produk..." class="input-field"></textarea>
            </div>

            <!-- FOTO -->
            <div class="form-group">
                <label>Foto Produk</label>
                <div class="upload-box">
                    <label for="fileInput" class="upload-btn">Choose File</label>
                    <input id="fileInput" type="file" name="file" multiple class="file-input">

                    <p id="fileName" class="file-name">Tidak ada file yang dipilih</p>
                    <div id="previewContainer" class="preview-container"></div>
                </div>
            </div>

            <!-- BUTTON -->
            <div class="form-actions">
                <button type="submit" class="btn-submit">Jual</button>
                <a href="/penjual/profil" class="btn-cancel">Cancel</a>
            </div>
        </form>
    </div>

    <div th:if="${error}">
    <script>
        alert("[GAGAL] Data tidak valid: [[${error}]]");
    </script>
    </div>

</main>


<!-- FORMAT HARGA -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    const hargaInput = document.getElementById("hargaInput");
    const hargaReal = document.getElementById("hargaReal");

    hargaInput.addEventListener("input", function () {
        let raw = this.value.replace(/[^0-9]/g, "");

        if (raw === "") {
    hargaReal.value = "";
    } else {
    hargaReal.value = raw;
    }
        hargaInput.value = "Rp " + new Intl.NumberFormat("id-ID").format(raw);
        hargaReal.value = raw;  
    });

});
</script>

<!-- MULTIPLE PREVIEW + DELETE -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    const fileInput = document.getElementById("fileInput");
    const fileName = document.getElementById("fileName");
    const previewContainer = document.getElementById("previewContainer");

    let filesArray = [];

    fileInput.addEventListener("change", function () {

        filesArray = filesArray.concat(Array.from(this.files));
        renderPreviews();
        fileInput.value = "";
    });

    function renderPreviews() {
        previewContainer.innerHTML = "";

        fileName.textContent = filesArray.length + " file dipilih";

        filesArray.forEach((file, index) => {

            if (!file.type.startsWith("image/")) return;

            const reader = new FileReader();
            reader.onload = function (e) {

                const item = document.createElement("div");
                item.classList.add("preview-item");

                item.innerHTML = `
                    <img src="${e.target.result}" class="preview-img">
                    <button class="delete-btn" data-index="${index}">Ã—</button>
                `;

                previewContainer.appendChild(item);
            };

            reader.readAsDataURL(file);
        });

        updateInputFiles();
    }

    previewContainer.addEventListener("click", function (e) {
        if (e.target.classList.contains("delete-btn")) {
            const index = e.target.dataset.index;
            filesArray.splice(index, 1);
            renderPreviews();
        }
    });

    function updateInputFiles() {
        const dataTransfer = new DataTransfer();
        filesArray.forEach(f => dataTransfer.items.add(f));
        fileInput.files = dataTransfer.files;
    }

});
</script>

</body>
</html>
